<!-- file: /duck-race-40/index.html -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>40 Ducks Race — GitHub Pages Ready</title>
  <style>
    :root{--track-w:900px;--lane-h:32px;--duck-h:28px}
    body{font-family:Inter,system-ui,Arial;margin:0;color:#222}
    header{padding:12px 20px;background:#0b72c4;color:#fff}
    .wrap{display:flex;gap:18px;padding:18px}
    .panel{width:360px}
    .panel h2{margin:0 0 12px}
    .names-grid{height:500px;overflow:auto;border:1px solid #e3e6ea;padding:8px;border-radius:8px;background:#fbfdff}
    .names-grid .row{display:flex;gap:8px;margin-bottom:6px}
    .names-grid input[type=text]{flex:1;padding:6px;border:1px solid #d0d7dd;border-radius:6px}
    label.small{font-size:12px;color:#555}
    .stage{flex:1;background:#e8f2ff;padding:18px;border-radius:8px;border:1px solid #e8eef6}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .controls input[type=number]{width:120px;padding:8px}
    button{background:#0b72c4;color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:#fff;color:#0b72c4;border:1px solid #0b72c4}
    .track{width:var(--track-w);height:calc(var(--lane-h) * 40);position:relative;overflow:hidden;border-radius:10px;border:4px solid #2c6f9b;background:linear-gradient(#3aa0ff,#2f7fb0)}
    .finish-line{position:absolute;right:120px;top:0;bottom:0;width:8px;background:repeating-linear-gradient(90deg,#fff 0 6px,#000 6px 12px);}
    .lane{position:absolute;left:0;right:0;height:var(--lane-h);border-bottom:1px solid rgba(255,255,255,0.06)}
    .duck{position:absolute;height:var(--duck-h);width:auto;left:8px;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000;text-shadow:1px 1px 2px #fff;}
    .duck img{height:var(--duck-h);width:auto;display:block;position:absolute;z-index:-1}
    .results{margin-top:12px;padding:12px;background:#fff;border-radius:8px;border:1px solid #e6eef6}
    table{width:100%;border-collapse:collapse}
    th,td{padding:6px;text-align:left;border-bottom:1px solid #eef3f8}
    footer{padding:12px 18px;text-align:center;color:#777}
    @media(max-width:980px){.wrap{flex-direction:column}.panel{width:100%}}
  </style>
</head>
<body>
  <header>
    <strong>Duck Race — 40 Vịt</strong>
  </header>
  <div class="wrap">
    <div class="panel">
      <h2>Thiết lập</h2>
      <label class="small">Thời gian (giây)</label>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
        <input id="raceTime" type="number" min="5" max="60" value="12">
        <button id="fillNames" class="ghost">Tự động điền</button>
        <button id="shuffleNames" class="ghost">Xáo</button>
      </div>
      <div class="names-grid" id="namesGrid"></div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="startBtn">Start</button>
        <button id="resetBtn" class="ghost">Reset</button>
      </div>
      <div class="results" id="results" hidden>
        <h3>Top 10</h3>
        <table id="resultsTable"><thead><tr><th>#</th><th>Name</th></tr></thead><tbody></tbody></table>
      </div>
    </div>
    <div class="stage">
      <div class="controls"><div style="font-weight:700">Đường đua</div></div>
      <div class="track" id="track"></div>
      <footer>Stop khi vịt đầu tiên về đích</footer>
    </div>
  </div>
  <audio id="finishSound" src="finish.mp3"></audio>
  <script>
    const DUCK_COUNT = 40;
    const namesGrid = document.getElementById('namesGrid');
    const track = document.getElementById('track');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const raceTimeInput = document.getElementById('raceTime');
    const resultsPanel = document.getElementById('results');
    const resultsTableBody = document.querySelector('#resultsTable tbody');
    const fillBtn = document.getElementById('fillNames');
    const shuffleBtn = document.getElementById('shuffleNames');
    const finishSound = document.getElementById('finishSound');
    const duckImgSrc = 'assets/duck.png';
    function createNameInputs(){
      namesGrid.innerHTML='';
      for(let i=0;i<DUCK_COUNT;i++){
        const row=document.createElement('div');row.className='row';
        const input=document.createElement('input');input.type='text';input.placeholder=`Duck ${i+1}`;
        row.appendChild(input);namesGrid.appendChild(row);
      }
    }
    function autoFillNames(){
      document.querySelectorAll('#namesGrid input').forEach((el,i)=>el.value=`Vịt ${i+1}`);
    }
    function shuffleNames(){
      const arr=Array.from(document.querySelectorAll('#namesGrid input')).map(el=>el.value||el.placeholder);
      for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}
      document.querySelectorAll('#namesGrid input').forEach((el,i)=>el.value=arr[i]);
    }
    fillBtn.onclick=autoFillNames;shuffleBtn.onclick=shuffleNames;
    createNameInputs();autoFillNames();
    let ducks=[],raf,running=false,lastTs;
    function getNames(){return Array.from(document.querySelectorAll('#namesGrid input')).map(el=>el.value||el.placeholder);}
    function buildTrack(){
      track.innerHTML='';
      for(let i=0;i<DUCK_COUNT;i++){
        const lane=document.createElement('div');lane.className='lane';lane.style.top=`${i*32}px`;track.appendChild(lane);
      }
      const finish=document.createElement('div');finish.className='finish-line';track.appendChild(finish);
      ducks=getNames().map((name,i)=>{
        const d=document.createElement('div');d.className='duck';d.style.top=`${i*32+2}px`;
        const img=document.createElement('img');img.src=duckImgSrc;
        d.textContent=name;d.appendChild(img);track.appendChild(d);
        return {name,el:d,x:8};
      });
    }
    function startRace(){
      if(running)return;buildTrack();
      const finishX=track.clientWidth-120;const targetTime=Math.max(5,Math.min(60,Number(raceTimeInput.value)||12));
      const distance=finishX-8;const baseSpeed=distance/(targetTime*60);
      ducks.forEach(d=>{d.speed=baseSpeed*(0.6+Math.random()*0.9);d.x=8;d.el.style.left=`${d.x}px`;});
      running=true;lastTs=null;resultsPanel.hidden=true;resultsTableBody.innerHTML='';
      function step(ts){
        if(!lastTs)lastTs=ts;const dt=ts-lastTs;lastTs=ts;const factor=dt/(1000/60);let winner=null;
        for(const d of ducks){d.x+=d.speed*factor*(1+(Math.random()*0.12-0.06));d.el.style.left=`${d.x}px`;if(d.x+50>=finishX&&!winner)winner=d;}
        if(winner){cancelAnimationFrame(raf);running=false;finishSound.play();const snapshot=ducks.map(d=>({name:d.name,dist:d.x}));snapshot.sort((a,b)=>b.dist-a.dist);showResults(snapshot.slice(0,10));return;}
        raf=requestAnimationFrame(step);
      }
      raf=requestAnimationFrame(step);
    }
    function showResults(list){
      resultsPanel.hidden=false;resultsTableBody.innerHTML='';list.forEach((r,i)=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${i+1}</td><td>${r.name}</td>`;if(i<3)tr.style.color='red';resultsTableBody.appendChild(tr);});
    }
    function resetRace(){if(raf)cancelAnimationFrame(raf);running=false;ducks=[];track.innerHTML='';resultsPanel.hidden=true;createNameInputs();autoFillNames();}
    startBtn.onclick=startRace;resetBtn.onclick=resetRace;buildTrack();
  </script>
</body>
</html>
